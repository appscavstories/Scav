document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("video-popup-button-wrapper"),t=document.getElementById("video-popup-button"),n=document.getElementById("video-popup-overlay"),o=document.getElementById("video-popup-close"),i=document.getElementById("popup-button-close"),c=document.getElementById("mute-story"),r=document.getElementById("pause-story"),l=document.getElementById("sound-icon"),s=document.getElementById("pause-icon"),a=Array.from(document.querySelectorAll(".story-video")),d=document.querySelectorAll(".progress-inner"),u=document.getElementById("tap-left"),p=document.getElementById("tap-right");let v=0,m,f=!1,h=!1,g=0;let y,b,E=!1;function x(t){E=!0;const n=e.getBoundingClientRect();y=(t.touches?t.touches[0].clientX:t.clientX)-n.left,b=(t.touches?t.touches[0].clientY:t.clientY)-n.top,e.style.transition="none"}function w(t){if(!E)return;t.preventDefault();const n=t.touches?t.touches[0].clientX:t.clientX,o=t.touches?t.touches[0].clientY:t.clientY,i=e.offsetWidth,c=e.offsetHeight,r=window.innerWidth-i,l=window.innerHeight-c;let s=n-y,a=o-b;s=Math.max(0,Math.min(s,r)),a=Math.max(0,Math.min(a,l)),e.style.left=`${s}px`,e.style.top=`${a}px`,e.style.bottom="auto"}function L(){E=!1,e.style.transition="left .1s ease, top .1s ease"}function k(){d.forEach(e=>e.style.width="0%"),cancelAnimationFrame(m)}function P(){a.forEach(e=>{e.pause(),e.currentTime=0})}function A(e,t,n=0){const o=d[e];if(!o)return;let i=null;function c(e){i||(i=e),h?g=parseFloat(o.style.width)/100:(e-i)/t+n>=1?(o.style.width="100%",T()):(o.style.width=100*Math.min((e-i)/t+n,1)+"%",m=requestAnimationFrame(c))}m=requestAnimationFrame(c)}function S(e){h=!1,O(!1),a.forEach((t,n)=>{t.pause(),t.classList.toggle("active",n===e),n===e&&(t.currentTime=0,t.muted=f,t.play().catch(()=>{}),k(),A(n,t.duration?t.duration*1e3:5e3))})}function T(){a[v]?.pause(),v=(v+1)%a.length,S(v)}function C(){a[v]?.pause(),v=(v-1+a.length)%a.length,S(v)}function N(){n.classList.remove("active"),P(),k(),h=!1,O(!1)}function O(e){s.innerHTML=e?'<polygon points="5 3 19 12 5 21 5 3"></polygon>':'<rect x="6" y="4" width="4" height="16" fill="white"></rect><rect x="14" y="4" width="4" height="16" fill="white"></rect>'}function B(){l.innerHTML=f?'<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line>':'<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19 5a9 9 0 0 1 0 14"></path>'}t.addEventListener("mousedown",x),t.addEventListener("touchstart",x,{passive:!0}),document.addEventListener("mousemove",w),document.addEventListener("touchmove",w,{passive:!1}),document.addEventListener("mouseup",L),document.addEventListener("touchend",L),t?.addEventListener("click",()=>{n.classList.add("active"),v=0,S(v)}),o?.addEventListener("click",N),n?.addEventListener("click",e=>{e.target===n&&N()}),p?.addEventListener("click",T),u?.addEventListener("click",C),c?.addEventListener("click",()=>{f=!f,a.forEach(e=>e.muted=f),B()}),r?.addEventListener("click",()=>{const e=a[v];if(!e)return;h=!h,h?(e.pause(),g=parseFloat(d[v].style.width)/100):(e.play().catch(()=>{}),A(v,(e.duration-e.currentTime)*1e3,g)),O(h)}),i?.addEventListener("click",()=>{e.remove()})});
